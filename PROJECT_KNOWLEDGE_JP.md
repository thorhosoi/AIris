# Airisプロジェクト知識ベース

このドキュメントは、2025年10月13日時点での「Airis」プロジェクトの現在の状態と理解をまとめています。コンテキストの維持とプロジェクトの進化を追跡するための包括的な知識リポジトリとして機能します。

**注意**: このドキュメントは、プロジェクトに関する新しい情報が利用可能になったり、状態が変化したりするたびに継続的に更新されるライブドキュメントです。また、トラブルシューティング手順の繰り返しを避けるために、重要な環境および手順に関するメモも記録します。

## 1. プロジェクト概要

- **プロジェクト名**: `Airis`
- **コンセプト**: 自己進化型AIワークフォースプラットフォーム。ユーザーから会話型CLIを通じて複雑で高レベルのタスクを受け取り、自律的なAIエージェントのチームが協力して解決するためにそれらを分解します。
- **主要目標**: 複雑な知的タスクを自動化することで、開発者とSREの生産性を劇的に向上させ、人間がより創造的な作業に集中できるようにする。
- **初期ターゲット**: IaC（Infrastructure as Code）によるクラウドインフラストラクチャのプロビジョニングなど、SRE/DevOpsタスクの自動化。

## 2. コアアーキテクチャとコンセプト

- **IACT（Interactive Agents Call Tree）**: これがコアアーキテクチャです。メインオーケストレーターがユーザーのリクエストを階層的なタスクツリーに分解します。ツリー内の各ノードは専門化されたAIエージェントに割り当てられます。エージェントは通信して協力してタスクを完了できます。
- **動的エージェント生成**: システムは、タスクの要件に基づいて必要なエージェント（コーディング、シェル実行、Web検索など）を動的に起動できます。
- **自己拡張**: 重要な長期機能。Airisは新しいツールの必要性を特定し、そのコードを書き、テストし、独自の機能に統合できます。
- **サンドボックス環境**: すべてのコードとシェルコマンドは、ホストシステムを保護するために安全で分離されたDockerコンテナ内で実行されます。これは重要な安全機能です。
- **ユーザーインザループ**: 安全性と制御のために、システムは潜在的に破壊的または不可逆的なアクション（シェルコマンドの実行やファイルの上書きなど）を実行する前にユーザーの承認を求めます。

## 3. MVP（最小実行可能製品）スコープ

### 3.1 フェーズ1（完了）
- **CLIインターフェース**: Typerベースのコマンドラインインターフェース
- **コードエージェント**: Pythonコード生成と実行
- **シェルエージェント**: 安全なシェルコマンド実行
- **ファイル出力**: 生成されたコードの保存
- **ユーザー承認**: 危険な操作の事前承認

### 3.2 フェーズ2（完了）
- **Web検索エージェント**: DuckDuckGoを使用したWeb検索機能
- **Webブラウジングエージェント**: URLからのコンテンツ取得・要約機能
- **ドキュメント完成度チェックエージェント**: ドキュメントの自動完成機能
- **Git管理エージェント**: 自動git操作（add, commit, push）機能
- **日本語ドキュメント生成**: 全てのドキュメントを日本語で生成

## 4. 技術スタック

- **言語**: Python 3.11+
- **CLIフレームワーク**: Typer
- **AI/エージェント**: LangChain、Anthropic Claude
- **コンテナ**: Docker SDK for Python
- **設定管理**: PyYAML、python-dotenv
- **テスト**: pytest
- **Web検索**: duckduckgo-search
- **Webスクレイピング**: requests、beautifulsoup4、lxml

## 5. ファイル構造

```
Airis/
├── airis/
│   ├── main.py              # エントリーポイント
│   ├── orchestrator.py      # メインオーケストレーター
│   ├── llm.py              # LLMクライアント
│   ├── config.py           # 設定管理
│   └── sandbox.py          # Dockerサンドボックス
├── agents/
│   ├── base.py             # ベースエージェントクラス
│   ├── code_agent.py       # コード生成エージェント
│   ├── shell_agent.py      # シェル実行エージェント
│   ├── cursor_agent.py     # Cursor編集エージェント
│   ├── web_search_agent.py # Web検索エージェント
│   ├── web_browser_agent.py # Webブラウジングエージェント
│   ├── document_completion_agent.py # ドキュメント完成エージェント
│   └── git_agent.py        # Git管理エージェント
├── projects/               # プロジェクトディレクトリ
├── doc/                    # プロジェクトドキュメント
├── tests/                  # テストファイル
├── config.yaml            # 設定ファイル
├── requirements.txt       # 依存関係
├── Dockerfile             # Dockerイメージ定義
├── docker-compose.yml     # Docker Compose設定
└── PROJECT_KNOWLEDGE.md   # 英語版知識ベース
```

## 6. 開発環境の注意事項

### 6.1 Docker設定
- **HOST_PROJECT_DIR**: ホストプロジェクトディレクトリの絶対パスを設定
- **ボリュームマウント**: プロジェクトファイルをコンテナ内にマウント
- **ネットワーク**: 外部APIアクセスのためのネットワーク設定

### 6.2 API設定
- **Anthropic API**: `ANTHROPIC_API_KEY`環境変数または`config.yaml`で設定
- **レート制限**: 1分間に4,000トークンに制限
- **モデル**: Claude 3 Sonnet（デフォルト）

### 6.3 Git設定
- **自動設定**: 初回実行時にgit設定を自動化
- **ユーザー名**: "Airis AI"
- **メール**: "airis@example.com"

## 7. 実装済み機能

### 7.1 コア機能
- **オーケストレーター**: キーワードベースのタスク委譲
- **エージェントシステム**: 7つの専門エージェント
- **プロジェクト管理**: プロジェクト作成・切り替え
- **ドキュメント生成**: 要件定義書・設計書・README生成

### 7.2 新機能（Phase 2）
- **Web検索**: DuckDuckGoを使用した検索・要約
- **Webブラウジング**: URLからのコンテンツ取得・要約
- **ドキュメント完成度チェック**: 自動完成機能
- **Git自動化**: コード変更の自動コミット
- **日本語対応**: 全ドキュメントの日本語化

### 7.3 技術的改善
- **コード実行**: Base64エンコーディングによる安定化
- **エラーハンドリング**: より詳細なエラーメッセージ
- **API制限対応**: トークン制限の最適化
- **ファイル命名**: より適切なファイル名（GEMINI.md → PROJECT_KNOWLEDGE.md）

## 8. 最近のトラブルシューティング

### 8.1 解決済み問題
- **temp_code.py not found**: Base64エンコーディングで解決
- **APIレート制限**: max_tokensを4,000に削減
- **ドキュメント途中切れ**: 完成度チェック機能で解決
- **Git認証エラー**: 自動設定機能で解決

### 8.2 現在の制限事項
- **リモートプッシュ**: SSH認証設定が必要
- **Web検索精度**: 一部の検索で関連性の低い結果
- **複雑なコード生成**: 構文エラーの自動修正に限界

## 9. プロジェクト規約

- **ファイル命名**: Pythonファイルはsnake_case、プロジェクトディレクトリはkebab-case
- **ドキュメント**: より良いアクセシビリティのためにすべてのドキュメントは日本語で記述
- **コードスタイル**: PEP 8ガイドラインに従う
- **テスト**: すべての新機能に単体テストを含める
- **知識ベース**: このファイルはプロジェクトの中央知識リポジトリとして機能
- **Git管理**: すべてのコード変更は自動的にgitにコミット
- **ドキュメント品質**: 生成されたすべてのドキュメントは完全性をチェックされ、必要に応じて自動完成

## 10. 最近の更新（2025-10-13）

### 追加された新機能
- **ドキュメント完成エージェント**: 不完全なドキュメントを自動的にチェック・完成
- **Git管理エージェント**: git操作（add, commit, push）を自動処理
- **Web検索エージェント**: DuckDuckGoを使用したWeb検索
- **Webブラウジングエージェント**: URLからのコンテンツ取得・要約
- **日本語ドキュメント**: 生成されたすべてのドキュメントが日本語
- **自動Gitコミット**: コード変更の自動gitコミット

### 技術的決定事項
- **ファイル名変更**: GEMINI.md → PROJECT_KNOWLEDGE.md（より適切な命名）
- **Max Tokens**: APIレート制限を避けるために4,000に削減
- **ドキュメント品質**: 完全なドキュメントを確保するための完成度チェック実装
- **Git統合**: すべてのコード変更の自動git操作
- **エラーハンドリング**: git操作とドキュメント生成のエラーハンドリング改善

### アーキテクチャ更新
- **エージェントシステム**: 4つの新エージェント追加（DocumentCompletion, Git, WebSearch, WebBrowser）
- **オーケストレーター**: 新エージェント用のキーワードベースルーティング強化
- **ドキュメント生成**: 日本語ドキュメント用のプロンプト改善
- **コード実行**: Base64エンコーディングアプローチによるtemp_code.py問題の修正

## 11. 今後の課題

### 11.1 短期課題
- **Web検索精度の向上**: 検索クエリの最適化
- **エラーハンドリングの強化**: より詳細なエラーメッセージ
- **テストカバレッジの拡大**: 新機能の単体テスト追加

### 11.2 長期課題
- **長期記憶機能**: 過去の対話履歴の保持
- **自動リトライ機能**: 失敗時の自動再試行
- **パフォーマンス最適化**: レスポンス時間の短縮

## 12. 使用方法

### 12.1 基本コマンド
```bash
# コード生成
echo y | docker-compose run -T --rm airis python3 -m airis.main "write a Python function to calculate fibonacci"

# 開発サイクル
echo y | docker-compose run -T --rm airis python3 -m airis.main "develop: create a web scraper"

# Web検索
echo y | docker-compose run -T --rm airis python3 -m airis.main "search for Python best practices"

# Webブラウジング
echo y | docker-compose run -T --rm airis python3 -m airis.main "browse https://www.python.org"

# ドキュメント完成
echo y | docker-compose run -T --rm airis python3 -m airis.main "complete doc project_name"

# Git管理
echo y | docker-compose run -T --rm airis python3 -m airis.main "git auto"
```

### 12.2 プロジェクト管理
```bash
# 新プロジェクト作成
echo y | docker-compose run -T --rm airis python3 -m airis.main "create new project my_project"

# プロジェクト切り替え
echo y | docker-compose run -T --rm airis python3 -m airis.main "use project my_project"

# ドキュメント生成
echo y | docker-compose run -T --rm airis python3 -m airis.main "generate docs requirements for my_project"
```

---

**文書管理**

- **作成日**: 2025-10-13
- **最終更新**: 2025-10-13
- **バージョン**: 2.0
- **言語**: 日本語
- **目的**: プロジェクト知識の日本語版引き継ぎ資料

**文書終了**
