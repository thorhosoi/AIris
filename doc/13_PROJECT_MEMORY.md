# Airis プロジェクト記憶システム

## バージョン情報

| 項目 | 内容 |
|------|------|
| 作成日 | 2025-10-13 |
| バージョン | 2.3.0 |
| 機能名 | Project Memory System |

---

## 1. 概要

プロジェクト記憶システムは、各プロジェクトの作業履歴、要件、仕様、会話履歴を自動的に記録・保持する機能です。

### 1.1 なぜプロジェクト記憶が必要か

**従来の問題**:
```
# 1日目: プロジェクトを作成
Airis> project create my_calculator
Airis> 計算プログラムを作って
[コードを生成]

# 3日後: 機能追加したい
Airis> project use my_calculator
Airis> 機能を追加したい

# 問題: Airisは過去の作業を覚えていない
# - どんなコードを生成したか不明
# - どんな仕様だったか不明
# - 一貫性のない機能追加のリスク
```

**プロジェクト記憶の解決策**:
```
# 3日後
Airis> project use my_calculator

Switched to project 'my_calculator'.

--- プロジェクト情報 ---
プロジェクト: my_calculator
会話履歴: 3件
生成ファイル: 2件
最終更新: 2025-10-10T15:30:00

💡 ヒント: このプロジェクトには過去の作業履歴があります
   '過去の作業を教えて' や '続きを行いたい' と入力してください

Airis> 過去の作業を教えて

======================================================================
プロジェクト記憶: my_calculator
======================================================================
# プロジェクト: my_calculator
作成日: 2025-10-10T10:00:00
最終更新: 2025-10-10T15:30:00

## 要件
- 四則演算（+, -, *, /）
- 対話的な入力
- エラーハンドリング

## 生成済みファイル
- src/calculator.py (python)
- src/test_calculator.py (python)

## 最近の会話
- [code_generation] 計算プログラムを作って
- [code_generation] テストコードも追加して
- [document_generation] READMEを作成して

Airis> この計算機に履歴機能を追加したい
[Airisは過去の仕様を理解した上で、一貫性のある機能追加を提案]
```

---

## 2. 機能詳細

### 2.1 自動記録される情報

| 項目 | 説明 | 保存タイミング |
|------|------|--------------|
| **会話履歴** | ユーザーとの対話内容 | 各対話完了時 |
| **生成ファイル** | 生成されたファイルのパス | ファイル保存時 |
| **要件** | プロジェクトの要件 | 要件確定時 |
| **仕様** | 技術仕様や設計情報 | 仕様決定時 |
| **AI操作** | 各エージェントの操作履歴 | タスク完了時 |
| **メモ** | 重要な決定事項やメモ | 手動追加時 |
| **使用技術** | 採用した技術スタック | 技術選定時 |

### 2.2 記憶の保存場所

```
projects/
└── my_calculator/
    ├── src/
    │   └── calculator.py
    ├── doc/
    ├── tests/
    └── .airis_memory/          # プロジェクト記憶
        └── context.json         # 記憶データ（JSON形式）
```

**注意**: `.airis_memory/`は`.gitignore`で除外されています（個人の作業履歴のため）

---

## 3. 使用方法

### 3.1 プロジェクトの継続作業

#### ステップ1: プロジェクトを選択

```bash
Airis> project use my_calculator

Switched to project 'my_calculator'.

--- プロジェクト情報 ---
プロジェクト: my_calculator
会話履歴: 5件
生成ファイル: 3件
最終更新: 2025-10-10T15:30:00

💡 このプロジェクトには過去の作業履歴があります
```

#### ステップ2: 過去の作業を確認

```bash
Airis> 過去の作業を教えて

# または
Airis> 過去の作業

# または
Airis> memory
```

#### ステップ3: 継続作業を依頼

```bash
Airis> この計算機に履歴機能を追加したい

💬 要件確認を開始します...

【分析】
既存の計算機プロジェクトに履歴機能を追加するリクエストですね。
過去の作業から、現在の実装は：
- 四則演算機能
- 対話的な入力
- エラーハンドリング

を持っていることを確認しました。

【確認事項】
1. 履歴機能の仕様は？
   A) 計算履歴を画面に表示
   B) ファイルに保存
   C) 両方

2. 履歴の保存件数は？
   A) 最新10件
   B) 最新50件
   C) 無制限

3. 既存のコードとの統合は？
   A) calculator.pyに追加
   B) 新しいモジュールとして分離
   
[対話継続...]
```

---

## 4. コマンドリファレンス

### 4.1 プロジェクト記憶関連コマンド

| コマンド | 説明 | 例 |
|---------|------|-----|
| `過去の作業` | プロジェクト記憶を表示 | `過去の作業を教えて` |
| `履歴` | 同上 | `履歴` |
| `memory` | 同上 | `memory` |
| `続き` | 続きを行いたい | `続きを行いたい` |
| `project use <名前>` | プロジェクト切り替え＆記憶読み込み | `project use my_app` |

### 4.2 記憶の確認方法

```bash
# 方法1: 対話型CLIで
Airis> 過去の作業

# 方法2: プロジェクト切り替え時に自動表示
Airis> project use my_calculator
[自動的にサマリーが表示される]

# 方法3: 記憶ファイルを直接確認
$ cat projects/my_calculator/.airis_memory/context.json
```

---

## 5. 記憶データの構造

### 5.1 context.json の例

```json
{
  "project_name": "my_calculator",
  "created_at": "2025-10-10T10:00:00",
  "last_updated": "2025-10-10T15:30:00",
  "description": "四則演算が可能な対話型計算プログラム",
  "requirements": [
    "四則演算（+, -, *, /）",
    "対話的な入力",
    "詳細なエラーハンドリング"
  ],
  "specifications": {
    "input_method": "interactive",
    "output_format": "console",
    "error_handling": "detailed"
  },
  "conversation_history": [
    {
      "timestamp": "2025-10-10T10:15:00",
      "task_type": "code_generation",
      "user_prompt": "計算プログラムを作って",
      "ai_response": "四則演算の計算機を生成しました..."
    }
  ],
  "generated_files": [
    {
      "timestamp": "2025-10-10T10:20:00",
      "path": "src/calculator.py",
      "type": "python",
      "description": "メイン計算機プログラム"
    }
  ],
  "ai_interactions": [
    {
      "timestamp": "2025-10-10T10:15:00",
      "agent": "code",
      "task": "Generate calculator code",
      "result": "Successfully generated calculator.py"
    }
  ],
  "technologies": ["Python", "pytest"],
  "notes": [
    {
      "timestamp": "2025-10-10T10:25:00",
      "content": "要件: ゼロ除算のエラーハンドリングを実装"
    }
  ]
}
```

---

## 6. 実際の使用シナリオ

### シナリオ1: 段階的な開発

#### 1日目: プロジェクト作成

```
Airis> project create web_app
Airis> FlaskでAPIサーバーを作って
[対話で要件確認]
Airis> (対話中) RESTful API、SQLite使用、CRUD操作
Airis> (対話中) execute
[実装完了、記憶に保存]
```

#### 3日目: 認証機能追加

```
Airis> project use web_app

💡 このプロジェクトには過去の作業履歴があります

Airis> 過去の作業を教えて

プロジェクト記憶:
- Flask APIサーバー
- SQLite データベース
- CRUD操作実装済み

Airis> JWT認証を追加したい

【分析】
既存のFlask APIサーバーにJWT認証を追加するリクエストですね。
現在の実装を確認しました：
- Flask APIサーバー
- SQLiteデータベース
- CRUD操作

【確認事項】
1. 認証が必要なエンドポイントは？
   A) すべて
   B) 一部（どれ？）
   
2. ユーザー管理は？
   A) 新規テーブル作成
   B) 既存テーブルに追加
   
[既存の実装を考慮した質問...]
```

### シナリオ2: バグ修正

```
Airis> project use my_game

Airis> 過去の作業

プロジェクト記憶:
- じゃんけんゲーム
- コンピューター対戦
- スコア記録機能

Airis> スコアが正しく保存されないバグを修正して

【分析】
じゃんけんゲームのスコア保存機能にバグがあるとのことですね。
過去の実装から、以下のファイルが関連していそうです：
- src/game.py (ゲームロジック)
- src/score_manager.py (スコア管理)

【確認事項】
1. どのような症状ですか？
   A) スコアが0のまま
   B) スコアが消える
   C) その他
   
2. いつから発生しましたか？
   A) 最初から
   B) 機能追加後
   
[過去の実装を理解した上でデバッグ...]
```

### シナリオ3: リファクタリング

```
Airis> project use data_analyzer

Airis> 続き

プロジェクト記憶:
- データ分析ツール
- CSV読み込み
- 統計計算機能

Airis> コードをクラスベースに書き直したい

【分析】
データ分析ツールをクラスベースに書き直すリクエストですね。
現在の実装は関数ベースで以下の機能があります：
- read_csv() - CSVファイル読み込み
- calculate_stats() - 統計計算
- generate_report() - レポート生成

【確認事項】
1. クラス構造は？
   A) DataAnalyzer クラス1つ
   B) 機能ごとに複数クラス
   
2. 既存のファイルは？
   A) 上書き
   B) 新しいファイル（old_をつけて保存）
   
[既存コードを理解した上でリファクタリング...]
```

---

## 7. 高度な使用例

### 7.1 複数の機能追加を段階的に実施

```
# フェーズ1
Airis> project use blog_app
Airis> コメント機能を追加
[実装＆記憶保存]

# フェーズ2
Airis> いいね機能を追加
[過去のコメント機能を考慮して実装]

# フェーズ3
Airis> タグ機能を追加
[コメント＆いいね機能との整合性を保って実装]
```

### 7.2 長期間のプロジェクト

```
# 1ヶ月前
Airis> project create e_commerce
[基本機能を実装]

# 2週間前
Airis> 決済機能を追加
[記憶に保存]

# 1週間前
Airis> 在庫管理を追加
[記憶に保存]

# 今日
Airis> project use e_commerce
Airis> 過去の作業

# 完全な履歴が表示される
# すべての機能を理解した上で、新機能を追加
```

---

## 8. 記憶の管理

### 8.1 記憶の確認

```bash
# 対話型CLIで
Airis> 過去の作業

# または詳細表示
Airis> memory

# プロジェクト一覧と記憶の有無
Airis> project list
```

### 8.2 記憶のクリア（将来実装）

```bash
# 記憶をリセットしたい場合
Airis> project forget

# または手動で削除
$ rm -rf projects/my_project/.airis_memory/
```

### 8.3 記憶のバックアップ

```bash
# プロジェクトディレクトリごとバックアップ
$ cp -r projects/my_project projects/my_project_backup

# 記憶ファイルのみバックアップ
$ cp projects/my_project/.airis_memory/context.json ~/backups/
```

---

## 9. 記憶の活用方法

### 9.1 過去の作業の続き

```
Airis> 続きを行いたい

【分析】
過去の作業を確認しました：
- 最後の作業: READMEの生成
- 未完了のタスク: なし
- 次に実装すべき機能候補:
  1. ユニットテストの追加
  2. エラーログ機能
  3. 設定ファイルのサポート

【質問】
どの機能を実装しますか？
```

### 9.2 一貫性の保持

```
Airis> 新しいモジュールを追加したい

【分析】
既存のプロジェクト構造を確認しました：
- 使用言語: Python
- フレームワーク: Flask
- データベース: SQLite
- コーディングスタイル: PEP 8準拠

新しいモジュールも同じ設計パターンで実装します。

【質問】
どのような機能のモジュールですか？
```

### 9.3 バグ修正時の文脈理解

```
Airis> エラーが出るので修正して

【分析】
過去の実装を確認し、以下のファイルが関連している可能性があります：
- src/main.py (エントリーポイント)
- src/database.py (データベース操作)

【質問】
1. どのような エラーメッセージが表示されますか？
2. どの操作で発生しますか？
3. エラーログはありますか？
```

---

## 10. 技術仕様

### 10.1 記憶の保存

```python
class ProjectMemory:
    def save_memory(self):
        """記憶をJSONファイルに保存"""
        self.memory["last_updated"] = datetime.now().isoformat()
        with open(self.memory_file, 'w') as f:
            json.dump(self.memory, f, indent=2)
```

### 10.2 記憶の読み込み

```python
def load_project_memory(project_name):
    """プロジェクト切り替え時に自動読み込み"""
    memory = ProjectMemory(project_name)
    return memory.get_project_context()
```

### 10.3 コンテキストの注入

```python
# 対話開始時にプロジェクト記憶をLLMに注入
prompt = f"""
{system_context}

【現在のプロジェクト情報】
{project_memory.get_project_context()}

【ユーザーのリクエスト】
{user_request}
"""
```

---

## 11. 制限事項と注意点

### 11.1 現在の制限

- 記憶は各プロジェクトごとに独立
- プロジェクト間での知識共有は未実装
- 記憶のサイズ制限: 会話50件、AI操作30件まで
- 自動削除: 古い記憶は自動的に削除される

### 11.2 プライバシーとセキュリティ

- 記憶は`.gitignore`で除外（個人的な作業履歴）
- ローカルのみに保存（外部送信なし）
- センシティブ情報は記録されない（APIキーなど）

### 11.3 推奨事項

✅ **定期的なバックアップ**: 重要なプロジェクトは定期的にバックアップ
✅ **明確な命名**: プロジェクト名は明確に
✅ **適切な粒度**: 1プロジェクト = 1機能単位が理想
⚠️ **機密情報**: 機密プロジェクトは記憶を無効化することも検討

---

## 12. トラブルシューティング

### 12.1 記憶が読み込まれない

**症状**: 過去の作業が表示されない

**原因**:
- プロジェクトが選択されていない
- `.airis_memory/`ディレクトリが削除された

**解決方法**:
```bash
# プロジェクトを選択
Airis> project use my_project

# 記憶ディレクトリの確認
$ ls -la projects/my_project/.airis_memory/
```

### 12.2 記憶が大きくなりすぎた

**症状**: 記憶ファイルが数MBに肥大化

**原因**: 大量の会話やAI操作が記録された

**解決方法**:
```bash
# 古い記憶をクリア（将来実装予定）
Airis> project clear old memory

# または手動で編集
$ vim projects/my_project/.airis_memory/context.json
```

---

## 13. ベストプラクティス

### 13.1 プロジェクト記憶を最大限活用

✅ **明確なコミット**: 各フェーズで明確な成果物を作成
✅ **メモの活用**: 重要な決定は必ずメモに残す
✅ **定期的な確認**: 大きな変更前に過去の作業を確認
✅ **段階的な開発**: 小さな機能を積み重ねる

### 13.2 記憶の整理

```
# 週次レビュー
Airis> 過去の作業
[記憶を確認]
[不要なメモを削除]

# マイルストーンごとにバックアップ
$ cp -r projects/my_app projects/my_app_v1.0
```

---

## 14. 将来の拡張

### 14.1 プロジェクト間の知識共有（Phase 4）

```
複数プロジェクトで共通のパターンを学習
    ↓
「前回のプロジェクトと同じ構成で」が使える
    ↓
テンプレート化して再利用
```

### 14.2 セマンティック検索（Phase 5）

```
「認証機能を実装したプロジェクトはある？」
    ↓
全プロジェクトの記憶を検索
    ↓
関連プロジェクトを提示
    ↓
そのコードを参考に実装
```

### 14.3 自動提案（Phase 6）

```
プロジェクトを開くと自動的に：
- 「前回の続きをやりますか？」
- 「未完了のタスクがあります」
- 「この機能を追加しませんか？」
```

---

## 15. まとめ

プロジェクト記憶システムにより：

1. **継続性**: 過去の作業を忘れない
2. **一貫性**: 既存の実装を理解した上で機能追加
3. **効率性**: 毎回ゼロから説明する必要がない
4. **品質**: 仕様の矛盾を防ぐ

Airisは真の意味で「継続的な開発パートナー」になります。

---

## 付録A: 使用例（詳細）

### A.1 初回プロジェクト作成

```
Airis> project create todo_app
Airis> ToDoアプリを作って

[対話で要件確認...]
Airis> (対話中) CLI、ローカルファイル保存、優先度機能
Airis> (対話中) execute

# 記憶に保存される情報:
# - 要件: CLI、ファイル保存、優先度
# - 生成ファイル: src/todo.py
# - 仕様: 保存形式JSON、優先度3段階
```

### A.2 機能追加（1週間後）

```
Airis> project use todo_app

プロジェクト記憶:
- CLI ToDoアプリ
- ファイル保存（JSON）
- 優先度機能（高/中/低）
- 生成ファイル: src/todo.py

Airis> 期限機能を追加したい

【分析】
既存のToDoアプリに期限機能を追加するリクエストですね。
現在の実装：
- タスクはJSONファイルで保存
- 優先度は3段階

期限機能を追加する場合、データ構造の変更が必要です。

【確認事項】
1. 期限の表示形式は？
   A) YYYY-MM-DD
   B) YYYY-MM-DD HH:MM
   
2. 期限切れの扱いは？
   A) 警告を表示
   B) 色を変える
   C) 別リストに表示
   
3. 既存データの移行は？
   A) 自動的にデフォルト期限を設定
   B) 手動で後から設定

[既存の実装と互換性を保ちながら機能追加...]
```

---

## 付録B: 記憶ファイルの直接編集

上級ユーザー向け：

```bash
# 記憶ファイルを編集
$ vim projects/my_project/.airis_memory/context.json

# 例: プロジェクト説明を追加
{
  "project_name": "my_project",
  "description": "機械学習モデルのトレーニングパイプライン",
  ...
}

# メモを追加
{
  ...
  "notes": [
    {
      "timestamp": "2025-10-13T10:00:00",
      "content": "注意: データセットは100MB以上ある"
    }
  ]
}
```

これにより、Airisに重要な情報を手動で伝えることもできます。

